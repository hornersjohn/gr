[gd_scene load_steps=3 format=2]

[ext_resource path="res://core/eff.tscn" type="PackedScene" id=1]

[sub_resource type="GDScript" id=1]
script/source = "extends Eff


# Declare member variables here. Examples:
# var a = 2
# var b = \"text\"
var isLoop = true

# Called when the node enters the scene tree for the first time.
func _ready():
	pass # Replace with function body.


# Called every frame. 'delta' is the elapsed time since the previous frame.
#func _process(delta):
#	pass
func setImgs(dirStr,fps = 15,isLoop = false):
	self.isLoop = isLoop
	var sf = SpriteFrames.new()
	var dir = Directory.new()
	sf.add_animation(\"idle\")
	sf.set_animation_loop(\"idle\",isLoop)
	sf.set_animation_speed(\"idle\",fps)
	dir.open(dirStr)
	dir.list_dir_begin()
	var dname = dir.get_next()
	while dname != \"\":
		if !dir.current_is_dir():
			var names = dname.split(\".\")
			if names[1] == \"png\":
				var fname = \"%s/%s\" % [dirStr,dname]
				var imt = null
				if sys.resPool.has(fname) :
					imt = sys.resPool[fname]
				else:
					var im = Image.new()
					im.load(fname)
					imt = ImageTexture.new()
					imt.create_from_image(im)
					imt.flags = 4
				sys.resPool[fname] = imt
				sf.add_frame(\"idle\",imt)
		dname = dir.get_next()
	dir.list_dir_end()
	$spr/normal/AnimatedSprite.frames = sf
	$spr/normal/AnimatedSprite.play(\"idle\")

func _on_AnimatedSprite_animation_finished():
	if isLoop == false:
		animation_finished(\"\")
"

[node name="eff" instance=ExtResource( 1 )]
script = SubResource( 1 )

[node name="AnimatedSprite" type="AnimatedSprite" parent="spr/normal" index="0"]

[node name="AnimationPlayer" type="AnimationPlayer" parent="." index="1"]
[connection signal="animation_finished" from="spr/normal/AnimatedSprite" to="." method="_on_AnimatedSprite_animation_finished"]
